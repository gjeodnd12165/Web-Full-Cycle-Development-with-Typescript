### 쿠버네티스를 이용한 서비스 운용
- 목표: 반복 실습과 함께 k8s 클러스터에 배포된 응용의 동작 보증 관찰
- 실습 단계
    - 간단한 테스트용 flask 웹 응용을 만들고 이것을 nginx 위에 쌓아 도커 이미지 만들기
    - 만들어진 이미지를 이용한 컨테이너를 실행하고 서비스로 노출하도록 매니페스트 작성
    - 이 응용을 (수동으로) k8s 클러스터에 배포하고 예외상황에 대한 k8s의 대처 방식 관측
        - 포드가 사멸하는 경우
        - 컨테이너 실행에 문제가 생기는 경우

#### 실습 도구로서의 웹 서버 만들기
- 예제로 간단한 웹 응용 제작
    - 기능: 웹 요청을 수신하여 이의 응답으로 다음의 두 가지 정보를 출력
        - hostname: 이것은 어떻게 설정될까? 노드의 정보인가?
        - IP 주소: 이것은 또 어떻게 설정될까? 포드에 동적으로 붙여지는 것인가?
    - 구현 방법
        - docker build를 통해 예제 서버 이미지 작성
        - 웹 서버로는 nginx 이용
        - Flask를 이용한 웹 응용 작성
        - 설정 및 구동 파일 등은 각각 작성해서 이미지에 추가
- 목적은?
    - 클러스터에서 수신한 요청에 대해 k8s가 반응하는 방식을 간단히 모니터링

#### 주기적인 요청을 이용해 테스트
- 주기적으로 요청을 반복하는 스크립트를 작성

- 요청이 반복적으로 도착하고 있는 상태에서, 클러스터 내에 예외상황이 발생하는 경우 k8s 가 어떻게 대응하는지 관찰

#### 디플로이먼트의 상태 유지
- 실험에서 관측한 바
    - 디플로이먼트에 의하여 포드들이 배포된 상태에서 이 중 하나 이상의 포드가 사멸하면
    - k8s는 새로운 포드를 생성하고 같은 종류의 컨테이너를 실행함
- 간접적으로 확인할 수 있는 바
    - 포드가 사멸하면 k8s는 새로운 포드를 생성함으로써 디플로이먼트에 선언된 "의도된 상태"를 유지하려고 함
    - 클러스터 외부에는 별도의 서비스에 의하여 노출되므로 개별 포드의 클러스터 내 IP 주소 등에대해서는 사용자가 관리할 필요 없음
    - 단, 포드는 언제든지 죽을 수 있는 오브젝트이므로 컨테이너에 기반한 으용을 개발함에 있어 stateless한 방식으로 만들어야함

#### 테스트: 컨테이너에 오류 발생
- 실험 시나리오
    - 같은 방식으로 배포된 응용이 서비스를 제공하고 있는 상태에서
    - 컨테이너에 셸 접속을 얻어
        - 이 응용을 실행하고 있는 프로세스의 PID를 알아내고
        - kill을 이용하여 이 프로세스를 강제 종료
- 관측할 사항
    - 추기적으로 이 서비스에 요청을 보내고 있는 스크립트가 어떤 응답을 받게 되는지 확인

#### 포드의 동작 보증
- 실험에서 관측한 바
    - 디플로이먼트에 의하여 배포된 포드의 컨테이너 실행에 문제가 생기면
    - k8s는 이 포드에서 실행하던 컨테이너를 삭제하고 다시 컨테이너를 생성해 응용을 지속 실행
- 간접적으로 확인할 수 있는 바
    - k8s에 의하여 관리되는 포드는 복구할 수 없는 오류를 맞닥뜨리는 경우에도 재시작에 의하여 정해진 동작을 지속하도록 보장됨
    